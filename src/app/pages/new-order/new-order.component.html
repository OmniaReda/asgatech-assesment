<div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-6">Create New Order</h1>
  
    @if (loading) {
      <div class="flex justify-center items-center h-64">
        <div class="text-gray-600">Loading...</div>
      </div>
    } @else if (error) {
      <div class="bg-red-100 text-red-700 p-4 rounded mb-4">
        {{ error }}
      </div>
    }
  
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Products Selection -->
      <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-4">Available Products</h2>
        <div class="grid grid-cols-1 gap-4">
          @for (product of products; track product.ProductId) {
            <div class="border p-3 rounded flex justify-between items-center">
              <div>
                <p class="font-medium">{{product.ProductName}}</p>
                <p class="text-sm text-gray-600">
                  Price: ${{product.ProductPrice}} | 
                  Available: {{product.AvailablePieces}}
                </p>
              </div>
              <button (click)="addToOrder(product)"
                      class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Add
              </button>
            </div>
          }
        </div>
      </div>
  
      <!-- Order Summary -->
      <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-4">Order Summary</h2>
  
        <!-- Customer Selection -->
        <div class="mb-4">
          <label class="block text-gray-700 mb-2">Select Customer</label>
          <select [(ngModel)]="selectedCustomerId"
                  class="w-full border rounded px-3 py-2">
            <option value="">Select a customer</option>
            @for (customer of customers; track customer.Id) {
              <option [value]="customer.Id">{{customer.Name}}</option>
            }
          </select>
        </div>
  
        <!-- Payment Type -->
        <div class="mb-4">
          <label class="block text-gray-700 mb-2">Payment Type</label>
          <select [(ngModel)]="paymentType"
                  class="w-full border rounded px-3 py-2">
            <option value="Cash">Cash</option>
            <option value="Online">Online</option>
          </select>
        </div>
  
        <!-- Selected Items -->
        <div class="mb-4">
          <h3 class="font-medium mb-2">Selected Items</h3>
          @if (selectedItems.length === 0) {
            <p class="text-gray-500">No items selected</p>
          } @else {
            @for (item of selectedItems; track item.product.ProductId; let i = $index) {
              <div class="border-b py-2 flex justify-between items-center">
                <div>
                  <p>{{item.product.ProductName}}</p>
                  <p class="text-sm text-gray-600">
                    ${{item.product.ProductPrice}} x 
                    <input type="number" [(ngModel)]="item.quantity"
                           (change)="updateQuantity(item, item.quantity)"
                           class="w-16 border rounded px-2 py-1"
                           [max]="item.product.AvailablePieces"
                           min="1">
                  </p>
                </div>
                <button (click)="removeItem(i)"
                        class="text-red-500 hover:text-red-700">
                  Remove
                </button>
              </div>
            }
            <div class="mt-4 text-right">
              <p class="font-bold">Total: ${{calculateTotal().toFixed(2)}}</p>
            </div>
          }
        </div>
  
        <!-- Submit Button -->
        <button (click)="submitOrder()"
                [disabled]="selectedItems.length === 0 || !selectedCustomerId"
                class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 disabled:bg-gray-400">
          Create Order
        </button>
        <!-- Update the Products Selection section -->
<div class="bg-white p-6 rounded-lg shadow">
    <h2 class="text-xl font-semibold mb-4">Available Products</h2>
    <div class="grid grid-cols-1 gap-4">
      @for (product of products; track product.ProductId) {
        <div class="border rounded-lg p-4 hover:shadow-md transition-all duration-200">
          <div class="flex justify-between items-center">
            <div>
              <p class="font-medium">{{product.ProductName}}</p>
              <div class="mt-1">
                <span class="text-sm text-gray-600">
                  Price: ${{product.ProductPrice}}
                </span>
                <span class="mx-2 text-gray-300">|</span>
                <span class="text-sm" [class.text-red-500]="product.AvailablePieces < 10">
                  Available: {{product.AvailablePieces}}
                </span>
              </div>
            </div>
            <button (click)="addToOrder(product)"
                    [disabled]="product.AvailablePieces === 0"
                    class="inline-flex items-center px-4 py-2 rounded-lg transition-colors duration-200"
                    [class.bg-blue-500.text-white.hover:bg-blue-600]="product.AvailablePieces > 0"
                    [class.bg-gray-200.text-gray-400.cursor-not-allowed]="product.AvailablePieces === 0">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Add to Order
            </button>
          </div>
        </div>
      }
    </div>
  </div>
  
  <!-- Update the Selected Items section -->
  @if (selectedItems.length === 0) {
    <div class="text-center py-8 text-gray-500">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <p>No items in your order yet</p>
    </div>
  } @else {
    @for (item of selectedItems; track item.product.ProductId; let i = $index) {
      <div class="flex items-center justify-between p-4 border-b">
        <div class="flex-1">
          <p class="font-medium">{{item.product.ProductName}}</p>
          <p class="text-sm text-gray-600">
            ${{item.product.ProductPrice}} per unit
          </p>
        </div>
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2">
            <button (click)="updateQuantity(item, item.quantity - 1)"
                    [disabled]="item.quantity <= 1"
                    class="w-8 h-8 rounded-full flex items-center justify-center transition-colors"
                    [class.bg-gray-200.hover:bg-gray-300]="item.quantity > 1"
                    [class.bg-gray-100.text-gray-400]="item.quantity <= 1">
              -
            </button>
            <input type="number" [(ngModel)]="item.quantity"
                   (change)="updateQuantity(item, item.quantity)"
                   class="w-16 text-center border rounded-md px-2 py-1"
                   [max]="item.product.AvailablePieces"
                   min="1">
            <button (click)="updateQuantity(item, item.quantity + 1)"
                    [disabled]="item.quantity >= item.product.AvailablePieces"
                    class="w-8 h-8 rounded-full flex items-center justify-center transition-colors"
                    [class.bg-gray-200.hover:bg-gray-300]="item.quantity < item.product.AvailablePieces"
                    [class.bg-gray-100.text-gray-400]="item.quantity >= item.product.AvailablePieces">
              +
            </button>
          </div>
          <button (click)="removeItem(i)"
                  class="text-red-500 hover:text-red-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>
        </div>
      </div>
    }
  }
      </div>
    </div>
  </div>